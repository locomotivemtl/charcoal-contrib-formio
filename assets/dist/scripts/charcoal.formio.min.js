/*! @locomotivemtl/charcoal-contrib-formio 07-02-2019 */

!function(){var t=function(t){Charcoal.Admin.Property.call(this,t),this.set_properties(t).init()};(t.prototype=Object.create(Charcoal.Admin.Property.prototype)).constructor=Charcoal.Admin.Property_Input_Formio_Form,t.prototype.parent=Charcoal.Admin.Property.prototype,t.prototype.set_properties=function(t){return this._builder=void 0,this._builder_options=t.data.builder_options,this.save_action=t.save_action||"object/save",this.update_action=t.update_action||"object/update",this.$widget=this.element(),this.$builder=this.$widget.find(".js-form-builder"),this.$input=this.$widget.find(".js-input"),this.$loader=this.$widget.find(".js-loader"),this},t.prototype.init=function(){var t=this;if(this.$loader.addClass("-is-loading"),"undefined"!=typeof Formio){var i=this.parse_options();this.init_builder(i)}else $.getScript("https://cdn.jsdelivr.net/npm/formiojs@3.13.10/dist/formio.full.min.js").done(function(){t.init()})},t.prototype.parse_options=function(){return this._builder_options=$.extend(!0,{},this._builder_options),this._builder_options},t.prototype.init_builder=function(t){var i=this,e=this.$input.val()?JSON.parse(this.$input.val()):{};Formio.builder(this.$builder.get(0),e,{builder:t}).then(function(t){i.$loader.removeClass("-is-loading"),i._builder=t})},t.prototype.save=function(){this.xhr=$.ajax({type:"POST",url:this.request_url(),data:{schema:this._builder.schema},dataType:"json",processData:!1,contentType:!1}),this.$input.val(JSON.stringify(this._builder.schema))},Charcoal.Admin.Property_Input_Formio_Form=t}(jQuery,document,Formio);